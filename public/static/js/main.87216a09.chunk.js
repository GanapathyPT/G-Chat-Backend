(this["webpackJsonpchat-app-frontend"]=this["webpackJsonpchat-app-frontend"]||[]).push([[0],{145:function(e,t,n){},229:function(e,t,n){},230:function(e,t,n){},237:function(e,t,n){"use strict";n.r(t);var a,r,c,s=n(0),o=n.n(s),i=n(67),u=n.n(i),l=n(17),p=n(11),d=n.n(p),T=n(16),j=n(37);!function(e){e[e.NOT_AUTHENTICATED=0]="NOT_AUTHENTICATED",e[e.AUTHENTICATED=1]="AUTHENTICATED",e[e.AUTHENTICATION_LOADING=2]="AUTHENTICATION_LOADING"}(a||(a={})),function(e){e[e.REGISTER=0]="REGISTER",e[e.LOGIN=1]="LOGIN",e[e.LOGOUT=2]="LOGOUT",e[e.AUTHENTICATE=3]="AUTHENTICATE",e[e.UPDATE_USERINFO=4]="UPDATE_USERINFO",e[e.SOCIAL_AUTH=5]="SOCIAL_AUTH"}(r||(r={})),function(e){e[e.SET_USERINFO=0]="SET_USERINFO",e[e.SET_AUTHSTATUS=1]="SET_AUTHSTATUS",e[e.UPDATE_USERINFO=2]="UPDATE_USERINFO",e[e.SET_SOCKET=4]="SET_SOCKET"}(c||(c={}));var O="access-token",b="refresh-token",h=function(e,t){e&&t&&localStorage.setItem(e,t)},f=function(){var e=Object(T.a)(d.a.mark((function e(t,n){var a,r,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:t,password:n})},e.next=3,fetch("/api/auth/login",a);case 3:return r=e.sent,e.next=6,r.json();case 6:return c=e.sent,h(O,c.accessToken),h(b,c.refreshToken),e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),S=function(){var e=Object(T.a)(d.a.mark((function e(t,n,a){var r,c,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:t,email:n,password:a})},e.next=3,fetch("/api/auth/register",r);case 3:return c=e.sent,e.next=6,c.json();case 6:return s=e.sent,h(O,s.accessToken),h(b,s.refreshToken),e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),_=function(){var e=Object(T.a)(d.a.mark((function e(){var t,n,a,r,c,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=localStorage.getItem("refresh-token"))){e.next=3;break}return e.abrupt("return",!1);case 3:return n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})},e.next=6,fetch("/api/auth/refresh",n);case 6:return a=e.sent,e.next=9,a.json();case 9:return r=e.sent,c=r.error,s=r.accessToken,h("access-token",s),e.abrupt("return",void 0===c);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m=function(){var e=Object(T.a)(d.a.mark((function e(){var t,n,a,r,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(t=localStorage.getItem("access-token"))){e.next=12;break}return n=JSON.parse(atob(t.split(".")[1])),a={method:"GET",headers:{Accept:"application/json",Authorization:"Bearer ".concat(t)}},e.next=7,fetch("/api/user/friends",a);case 7:return r=e.sent,e.next=10,r.json();case 10:return c=e.sent,e.abrupt("return",{_id:n._id,email:n.email,username:n.username,friends:c.result});case 12:return e.abrupt("return",null);case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",null);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=Object(T.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=localStorage.getItem("access-token"),n={method:"GET",headers:{Authorization:"Bearer ".concat(t)}},e.next=4,fetch("/api/auth/logout",n);case 4:localStorage.removeItem("access-token"),localStorage.removeItem("refresh-token");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(T.a)(d.a.mark((function e(t){var n,a,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({token:t})},e.next=3,fetch("/api/auth/googleAuth",n);case 3:return a=e.sent,e.next=6,a.json();case 6:return r=e.sent,h(O,r.accessToken),h(b,r.refreshToken),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=n(105),g="/",v={authStatus:a.NOT_AUTHENTICATED,userInfo:{},socket:null},U=function(e,t){switch(t.type){case c.SET_USERINFO:return Object(j.a)(Object(j.a)({},e),{},{userInfo:t.payload});case c.SET_AUTHSTATUS:return Object(j.a)(Object(j.a)({},e),{},{authStatus:t.payload});case c.UPDATE_USERINFO:return Object(j.a)(Object(j.a)({},e),{},{userInfo:Object(j.a)(Object(j.a)({},e.userInfo),t.payload)});case c.SET_SOCKET:return Object(j.a)(Object(j.a)({},e),{},{socket:t.payload});default:return e}},y=function(e){return function(){var t=Object(T.a)(d.a.mark((function t(n){var s,o,i,u,l,p,T,j,O,b,h,v,U,y,I,N,C,k,w,H,D,R,P,L,F,G,K,M;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=n.type,t.next=t.t0===r.REGISTER?3:t.t0===r.LOGIN?19:t.t0===r.AUTHENTICATE?35:t.t0===r.LOGOUT?48:t.t0===r.UPDATE_USERINFO?55:t.t0===r.SOCIAL_AUTH?58:74;break;case 3:return e({type:c.SET_AUTHSTATUS,payload:a.AUTHENTICATION_LOADING}),s=n.payload,o=s.email,i=s.password,u=s.username,t.next=7,S(u,o,i);case 7:if(l=t.sent,null!==(p=l.errors)){t.next=16;break}return t.next=12,m();case 12:null!==(T=t.sent)?(e({type:c.SET_USERINFO,payload:T}),e({type:c.SET_AUTHSTATUS,payload:a.AUTHENTICATED}),j=Object(x.connect)(g),e({type:c.SET_SOCKET,payload:j})):e({type:c.SET_AUTHSTATUS,payload:a.NOT_AUTHENTICATED}),t.next=18;break;case 16:return e({type:c.SET_AUTHSTATUS,payload:a.NOT_AUTHENTICATED}),t.abrupt("return",p);case 18:return t.abrupt("return");case 19:return e({type:c.SET_AUTHSTATUS,payload:a.AUTHENTICATION_LOADING}),O=n.payload,b=O.email,h=O.password,t.next=23,f(b,h);case 23:if(v=t.sent,null!==(U=v.errors)){t.next=32;break}return t.next=28,m();case 28:null!==(y=t.sent)?(e({type:c.SET_USERINFO,payload:y}),e({type:c.SET_AUTHSTATUS,payload:a.AUTHENTICATED}),I=Object(x.connect)(g),e({type:c.SET_SOCKET,payload:I})):e({type:c.SET_AUTHSTATUS,payload:a.NOT_AUTHENTICATED}),t.next=34;break;case 32:return e({type:c.SET_AUTHSTATUS,payload:a.NOT_AUTHENTICATED}),t.abrupt("return",U);case 34:return t.abrupt("return");case 35:return(N=n.payload.loading)&&e({type:c.SET_AUTHSTATUS,payload:a.AUTHENTICATION_LOADING}),t.next=39,_();case 39:if(!(C=t.sent)){t.next=45;break}return t.next=43,m();case 43:null!==(k=t.sent)&&(e({type:c.SET_USERINFO,payload:k}),N&&(w=Object(x.connect)(g),e({type:c.SET_SOCKET,payload:w})));case 45:return e({type:c.SET_AUTHSTATUS,payload:C?a.AUTHENTICATED:a.NOT_AUTHENTICATED}),N&&e({type:c.SET_AUTHSTATUS,payload:C?a.AUTHENTICATED:a.NOT_AUTHENTICATED}),t.abrupt("return");case 48:return e({type:c.SET_AUTHSTATUS,payload:a.AUTHENTICATION_LOADING}),t.next=51,E();case 51:return e({type:c.SET_USERINFO,payload:{}}),e({type:c.SET_AUTHSTATUS,payload:a.NOT_AUTHENTICATED}),e({type:c.SET_SOCKET,payload:null}),t.abrupt("return");case 55:return H=n.payload,D=H.email,R=H.username,P=H.friends,D?e({type:c.UPDATE_USERINFO,payload:{email:D}}):R?e({type:c.UPDATE_USERINFO,payload:{username:R}}):P&&e({type:c.UPDATE_USERINFO,payload:{friends:P}}),t.abrupt("return");case 58:return e({type:c.SET_AUTHSTATUS,payload:a.AUTHENTICATION_LOADING}),L=n.payload.token,t.next=62,A(L);case 62:if(F=t.sent,null!==(G=F.errors)){t.next=71;break}return t.next=67,m();case 67:null!==(K=t.sent)?(e({type:c.SET_USERINFO,payload:K}),e({type:c.SET_AUTHSTATUS,payload:a.AUTHENTICATED}),M=Object(x.connect)(g),e({type:c.SET_SOCKET,payload:M})):e({type:c.SET_AUTHSTATUS,payload:a.NOT_AUTHENTICATED}),t.next=73;break;case 71:return e({type:c.SET_AUTHSTATUS,payload:a.NOT_AUTHENTICATED}),t.abrupt("return",G);case 73:case 74:return t.abrupt("return");case 75:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},I=n(4),N=Object(s.createContext)({}),C=function(e){var t=e.children,n=Object(s.useReducer)(U,v),a=Object(l.a)(n,2),r=a[0],c=a[1],o={authInfo:r,dispatch:y(c)};return Object(I.jsx)(N.Provider,{value:o,children:t})},k=(n(228),n(229),n(145),n(230),n(83)),w=n(13),H=n(263),D=n(252);function R(){return Object(I.jsx)(H.a,{active:!0,inverted:!0,children:Object(I.jsx)(D.a,{size:"large",children:"Loading"})})}var P=n(127),L=n.n(P),F=n(261),G=n(259),K=n(254),M=n(238);function z(e){var t=e.loginUser,n=e.onSuccess,a=Object(s.useState)(""),r=Object(l.a)(a,2),c=r[0],o=r[1],i=Object(s.useState)(""),u=Object(l.a)(i,2),p=u[0],d=u[1],T=Object(s.useState)({}),j=Object(l.a)(T,2),O=j[0],b=j[1];return Object(I.jsxs)("div",{className:"login__page",children:[Object(I.jsxs)(F.a,{color:"blue",raised:!0,className:"login__card",children:[Object(I.jsx)("h3",{children:"Login"}),Object(I.jsxs)(G.a,{onSubmit:function(){return t(c,p,b)},children:[Object(I.jsx)(G.a.Input,{label:"Email",placeholder:"email",icon:"mail",iconPosition:"left",value:c,onChange:function(e){return o(e.target.value)},error:O.email}),Object(I.jsx)(G.a.Input,{label:"Password",placeholder:"password",type:"password",icon:"key",iconPosition:"left",value:p,onChange:function(e){return d(e.target.value)},error:O.password}),Object(I.jsx)(K.a,{horizontal:!0,children:"or"}),Object(I.jsx)(G.a.Field,{className:"btn__center",children:Object(I.jsx)(L.a,{clientId:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SOCKET_URL:"/"}).REACT_APP_GOOGLE_CLIENT_ID,buttonText:"Login with Google",onSuccess:n,cookiePolicy:"single_host_origin"})}),Object(I.jsx)(M.a,{type:"submit",primary:!0,children:"Sign In"})]})]}),Object(I.jsxs)("small",{children:["Don't have a account? ",Object(I.jsx)(k.b,{to:"/register",children:"SignUp"})]})]})}function B(){var e=Object(s.useContext)(N),t=e.authInfo,n=e.dispatch,c=Object(s.useCallback)(function(){var e=Object(T.a)(d.a.mark((function e(t,a,c){var s,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c({}),e.next=3,n({type:r.LOGIN,payload:{email:t,password:a}});case 3:void 0!==(s=e.sent)&&(o={},s.forEach((function(e){switch(e.param){case"email":o.email=e.msg;break;case"password":o.password=e.msg}})),c(o));case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),[]);return t.authStatus===a.AUTHENTICATED?Object(I.jsx)(w.a,{to:"/"}):Object(I.jsx)(z,{loginUser:c,onSuccess:function(e){var t=e;n({type:r.SOCIAL_AUTH,payload:{token:t.tokenId}})}})}function J(e){var t=e.registerUser,n=e.onSuccess,a=Object(s.useState)(""),r=Object(l.a)(a,2),c=r[0],o=r[1],i=Object(s.useState)(""),u=Object(l.a)(i,2),p=u[0],d=u[1],T=Object(s.useState)(""),j=Object(l.a)(T,2),O=j[0],b=j[1],h=Object(s.useState)({}),f=Object(l.a)(h,2),S=f[0],_=f[1];return Object(I.jsxs)("div",{className:"login__page",children:[Object(I.jsxs)(F.a,{color:"blue",raised:!0,className:"login__card",children:[Object(I.jsx)("h3",{children:"Register"}),Object(I.jsxs)(G.a,{onSubmit:function(){return t(c,p,O,_)},children:[Object(I.jsx)(G.a.Input,{label:"User Name",placeholder:"username",icon:"user",iconPosition:"left",value:c,onChange:function(e){return o(e.target.value)},error:S.username}),Object(I.jsx)(G.a.Input,{label:"Email",placeholder:"email",icon:"mail",iconPosition:"left",value:p,onChange:function(e){return d(e.target.value)},error:S.email}),Object(I.jsx)(G.a.Input,{label:"Password",placeholder:"password",type:"password",icon:"key",iconPosition:"left",value:O,onChange:function(e){return b(e.target.value)},error:S.password}),Object(I.jsx)(K.a,{horizontal:!0,children:"or"}),Object(I.jsx)(G.a.Field,{className:"btn__center",children:Object(I.jsx)(L.a,{clientId:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SOCKET_URL:"/"}).REACT_APP_GOOGLE_CLIENT_ID,buttonText:"Register with Google",onSuccess:n,cookiePolicy:"single_host_origin"})}),Object(I.jsx)(M.a,{type:"submit",primary:!0,children:"Sign Up"})]})]}),Object(I.jsxs)("small",{children:["Already have a account? ",Object(I.jsx)(k.b,{to:"/login",children:"SignUp"})]})]})}function W(){var e=Object(s.useContext)(N),t=e.authInfo,n=e.dispatch,c=Object(s.useCallback)(function(){var e=Object(T.a)(d.a.mark((function e(t,a,c,s){var o,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s({}),e.next=3,n({type:r.REGISTER,payload:{username:t,email:a,password:c}});case 3:void 0!==(o=e.sent)&&(i={},o.forEach((function(e){switch(e.param){case"username":i.username=e.msg;break;case"email":i.email=e.msg;break;case"password":i.password=e.msg}})),s(i));case 5:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),[]);return t.authStatus===a.AUTHENTICATED?Object(I.jsx)(w.a,{to:"/"}):Object(I.jsx)(J,{registerUser:c,onSuccess:function(e){var t=e;n({type:r.SOCIAL_AUTH,payload:{token:t.tokenId}})}})}var V=n(149),q=function(){var e=Object(T.a)(d.a.mark((function e(t){var n,a,r,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem("access-token"),a={method:"GET",headers:{Accept:"application/json",Authorization:"Bearer ".concat(n)}},e.next=4,fetch("/api/user/get-user?"+new URLSearchParams({q:t}),a);case 4:return r=e.sent,e.next=7,r.json();case 7:return c=e.sent,e.abrupt("return",c.result);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=function(){var e=Object(T.a)(d.a.mark((function e(t){var n,a,r,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem("access-token"),a={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({newFriend:t})},e.next=4,fetch("/api/user/add-friend",a);case 4:return r=e.sent,e.next=7,r.json();case 7:return c=e.sent,e.abrupt("return",c.result);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X=n(255),Y=n(175),Z=n(174),$=n(266),ee=n(50),te=n(265),ne=n(256),ae=n(262),re=n(253),ce=function(e){var t=(e=new Date(e)).getHours()%12,n=e.getMinutes();return"".concat(t,":").concat(n)};var se=function(e){var t=e.messages,n=e.sendMessage,a=e.deSelectUser,r=Object(s.useContext)(N).authInfo,c=Object(s.useState)(""),o=Object(l.a)(c,2),i=o[0],u=o[1],p=Object(s.useRef)(null);return Object(s.useEffect)((function(){p&&p.current&&p.current.scrollIntoView()}),[t,i,p]),Object(I.jsxs)(te.a,{className:"chat__box",children:[Object(I.jsx)(ee.a,{className:"back__btn",name:"arrow left",size:"big",onClick:a}),Object(I.jsx)(ne.a,{trigger:Object(I.jsx)(ee.a,{className:"info__btn",name:"info circle",size:"big"}),content:Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(ae.a,{warning:!0,size:"small",header:"Not Encrypted",content:"messages are not encrypted in this app, don't share any personal info"}),Object(I.jsx)(ae.a,{success:!0,size:"small",header:"Auto Delete",content:"Messages will be deleted after 24 hours"})]})}),Object(I.jsxs)("div",{className:"chat__messages__container",children:[t.map((function(e){return Object(I.jsx)("p",{className:"chat__message ".concat(e.author===r.userInfo._id?"our__message":""),children:Object(I.jsxs)("span",{children:[e.message,Object(I.jsx)("small",{children:ce(e.timestamp)})]})},e._id)})),Object(I.jsx)("div",{ref:p})]}),Object(I.jsx)(re.a,{autoFocus:!0,value:i,className:"chat__input",onKeyPress:function(e){13===e.charCode&&(n(e.target.value),u(""))},onChange:function(e){return u(e.target.value)},label:Object(I.jsx)(M.a,{primary:!0,icon:!0,active:!0,onClick:function(){n(i),u("")},children:Object(I.jsx)(ee.a,{name:"send"})}),labelPosition:"right",placeholder:"Type anything . . ."})]})},oe=n(257),ie=n(258),ue=n(260),le=n(176),pe=["rachel.png","lindsay.png","matthew.png","jenny.jpg","veronika.jpg","tom.jpg","christian.jpg","matt.jpg","daniel.jpg"];var de=function(e){var t,n=e.loading,a=e.onResultSelect,r=e.onSearchChange,c=e.results,o=e.value,i=e.activeUser,u=e.userOnClick,l=e.logoutUser,p=Object(s.useContext)(N).authInfo;return Object(I.jsxs)("div",{children:[Object(I.jsxs)("div",{className:"search__menu",children:[Object(I.jsx)(oe.a,{placeholder:"Search User . . .",loading:n,onResultSelect:a,onSearchChange:r,results:c,value:o}),Object(I.jsx)(ie.a,{simple:!0,className:"menu__dropdown",direction:"left",icon:"ellipsis vertical",children:Object(I.jsx)(ie.a.Menu,{children:Object(I.jsx)(ie.a.Item,{onClick:l,children:"Logout"})})})]}),Object(I.jsx)(ue.a,{animated:!0,celled:!0,size:"big",className:"friends__list",children:null===(t=p.userInfo.friends)||void 0===t?void 0:t.map((function(e){return Object(I.jsxs)(ue.a.Item,{active:(null===i||void 0===i?void 0:i._id)===e._id,className:"list__item",onClick:function(){return u(e._id)},children:[Object(I.jsx)(le.a,{avatar:!0,src:"https://react.semantic-ui.com/images/avatar/small/".concat(pe[Math.floor(Math.random()*pe.length)])}),Object(I.jsxs)(ue.a.Content,{children:[Object(I.jsx)(ue.a.Header,{children:e.username}),Object(I.jsx)(ue.a.Description,{children:e.email})]})]},e._id)}))})]})};function Te(e){var t,n=e.loading,a=e.onResultSelect,r=e.onSearchChange,c=e.results,o=e.value,i=e.activeUser,u=e.messages,l=e.userOnClick,p=e.logoutUser,d=e.sendMessage,T=e.deSelectUser,j=e.messagesLoading,O=Object(s.useContext)(N).authInfo;return Object(I.jsx)(X.a,{columns:"two",divided:!0,className:"home__container",children:Object(I.jsxs)(Y.a,{children:[Object(I.jsxs)(Z.a,{computer:4,mobile:16,className:"full__height ".concat(i?"display__none__mobile":""),children:[Object(I.jsx)($.a,{textAlign:"center",size:"huge",children:"G - Chat"}),Object(I.jsx)(de,{loading:n,onResultSelect:a,onSearchChange:r,results:c,value:o,activeUser:i,userOnClick:l,logoutUser:p})]}),Object(I.jsx)(Z.a,{computer:12,mobile:16,className:"full_height ".concat(i?"":"display__none__mobile"),children:i?j?Object(I.jsx)(R,{}):Object(I.jsx)(se,{sendMessage:d,messages:u,deSelectUser:T}):(null===(t=O.userInfo.friends)||void 0===t?void 0:t.length)?Object(I.jsx)("div",{className:"full__height center",children:Object(I.jsxs)($.a,{as:"h2",icon:!0,children:[Object(I.jsx)(ee.a,{name:"user"}),"Select a Friend to Chat",Object(I.jsx)($.a.Subheader,{children:"select the friend from the sidebar to chat"})]})}):Object(I.jsx)("div",{className:"full__height center",children:Object(I.jsxs)($.a,{as:"h2",icon:!0,children:[Object(I.jsx)(ee.a,{name:"hand peace"}),"Hii ",O.userInfo.username,Object(I.jsx)($.a.Subheader,{children:"search for admin to chat with me"})]})})})]})})}function je(){var e=Object(s.useContext)(N),t=e.authInfo,n=e.dispatch,c=Object(s.useState)(""),o=Object(l.a)(c,2),i=o[0],u=o[1],p=Object(s.useState)(!1),j=Object(l.a)(p,2),O=j[0],b=j[1],h=Object(s.useState)([]),f=Object(l.a)(h,2),S=f[0],_=f[1],m=Object(s.useState)(null),E=Object(l.a)(m,2),A=E[0],x=E[1],g=Object(s.useState)([]),v=Object(l.a)(g,2),U=v[0],y=v[1],C=Object(s.useState)(!1),k=Object(l.a)(C,2),H=k[0],D=k[1];Object(s.useEffect)((function(){var e=t.socket;null!==e&&(e.on("oldMessages",(function(e){var t=e.messages;y(t),D(!1)})),e.on("newMessage",(function(e){var t=e.newMessage;y((function(e){return[].concat(Object(V.a)(e),[t])}))})),e.on("alert",(function(e){return alert(e)})))}),[t.socket]);var R=function(){var e=Object(T.a)(d.a.mark((function e(n){var a,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.userInfo,e.next=3,q(n);case 3:return r=e.sent,e.abrupt("return",r.filter((function(e){return e._id!==a._id})).map((function(e){return{_id:e._id,title:e.username,description:e.email}})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(T.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.value){e.next=10;break}return u(n.value),b(!0),e.next=5,R(n.value);case 5:a=e.sent,_(a),b(!1),e.next=11;break;case 10:u("");case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),L=function(){var e=Object(T.a)(d.a.mark((function e(n){var a,r,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(a=t.userInfo.friends)&&(r=a.find((function(e){return e._id===n})))&&(y([]),D(!0),null===(c=t.socket)||void 0===c||c.emit("getMessages",{roomId:r.roomId}),x(r));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=Object(T.a)(d.a.mark((function e(a,c){var s,o,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(s=t.userInfo.friends)){e.next=12;break}if(void 0!==(o=s.find((function(e){return e._id===c.result._id})))){e.next=11;break}return e.next=6,Q(c.result._id);case 6:i=e.sent,n({type:r.UPDATE_USERINFO,payload:{friends:[].concat(Object(V.a)(s),[i])}}),L(i._id),e.next=12;break;case 11:L(o._id);case 12:u("");case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),G=function(){var e=Object(T.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:r.LOGOUT});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return t.authStatus!==a.AUTHENTICATED?Object(I.jsx)(w.a,{to:"/login"}):Object(I.jsx)(Te,{loading:O,onResultSelect:F,onSearchChange:P,results:S,value:i,activeUser:A,messages:U,userOnClick:L,logoutUser:G,sendMessage:function(e){var n;0!==e.trim().length&&(null===(n=t.socket)||void 0===n||n.emit("sendMessage",{roomId:null===A||void 0===A?void 0:A.roomId,author:t.userInfo._id,message:e,time:new Date}))},deSelectUser:function(){x(null),y([])},messagesLoading:H})}var Oe=function(){var e=Object(s.useContext)(N),t=e.authInfo,n=e.dispatch;return Object(s.useEffect)((function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n({type:r.AUTHENTICATE,payload:{loading:e}})};e(!0);var t=setInterval(e,36e5);return function(){return clearInterval(t)}}),[]),t.authStatus===a.AUTHENTICATION_LOADING?Object(I.jsx)(R,{}):Object(I.jsx)(k.a,{children:Object(I.jsxs)(w.d,{children:[Object(I.jsx)(w.b,{exact:!0,path:"/",component:je}),Object(I.jsx)(w.b,{path:"/login",component:B}),Object(I.jsx)(w.b,{path:"/register",component:W}),Object(I.jsx)(w.b,{path:"/",component:function(){return Object(I.jsx)(w.a,{to:"/login"})}})]})})},be=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,268)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),a(e),r(e),c(e),s(e)}))};u.a.render(Object(I.jsx)(o.a.StrictMode,{children:Object(I.jsx)(C,{children:Object(I.jsx)(Oe,{})})}),document.getElementById("root")),be()}},[[237,1,2]]]);
//# sourceMappingURL=main.87216a09.chunk.js.map